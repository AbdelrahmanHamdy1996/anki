

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>aqt.tts &mdash; Anki  documentation</title>
  

  
  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />

  
  
  
  

  
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/doctools.js"></script>
        <script src="../../_static/language_data.js"></script>
        <script async="async" kind="hypothesis" src="https://hypothes.is/embed.js"></script>
    
    <script type="text/javascript" src="../../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../index.html" class="icon icon-home" alt="Documentation Home"> Anki
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../anki.html">anki package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../anki.importing.html">anki.importing package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../aqt.html">aqt package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../genhooks_gui.html">genhooks_gui module</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tools.html">tools package</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">Anki</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="../index.html">Module code</a> &raquo;</li>
        
          <li><a href="../aqt.html">aqt</a> &raquo;</li>
        
      <li>aqt.tts</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <h1>Source code for aqt.tts</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Basic text to speech support.</span>

<span class="sd">Users can use the following in their card template:</span>

<span class="sd">{{tts en_US:Field}}</span>

<span class="sd">or</span>

<span class="sd">{{tts ja_JP voices=Kyoko,Otoya,Another_name:Field}}</span>

<span class="sd">The first argument must be an underscored language code, eg en_US.</span>

<span class="sd">If provided, voices is a comma-separated list of one or more voices that</span>
<span class="sd">the user would prefer. Spaces must not be included. Underscores will be</span>
<span class="sd">converted to spaces.</span>

<span class="sd">AVPlayer decides which TTSPlayer to use based on the returned rank.</span>
<span class="sd">In the default implementation, the TTS player is chosen based on the order</span>
<span class="sd">of voices the user has specified. When adding new TTS players, your code</span>
<span class="sd">can either expose the underlying names the TTS engine provides, or simply</span>
<span class="sd">expose the name of the engine, which would mean the user could write</span>
<span class="sd">{{tts en_AU voices=MyEngine}} to prioritize your engine.</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">annotations</span>

<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">re</span>
<span class="kn">import</span> <span class="nn">subprocess</span>
<span class="kn">from</span> <span class="nn">concurrent.futures</span> <span class="kn">import</span> <span class="n">Future</span>
<span class="kn">from</span> <span class="nn">dataclasses</span> <span class="kn">import</span> <span class="n">dataclass</span>
<span class="kn">from</span> <span class="nn">operator</span> <span class="kn">import</span> <span class="n">attrgetter</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Any</span><span class="p">,</span> <span class="n">List</span><span class="p">,</span> <span class="n">Optional</span><span class="p">,</span> <span class="n">cast</span>

<span class="kn">from</span> <span class="nn">anki</span> <span class="kn">import</span> <span class="n">hooks</span>
<span class="kn">from</span> <span class="nn">anki.sound</span> <span class="kn">import</span> <span class="n">AVTag</span><span class="p">,</span> <span class="n">TTSTag</span>
<span class="kn">from</span> <span class="nn">anki.utils</span> <span class="kn">import</span> <span class="n">checksum</span><span class="p">,</span> <span class="n">isWin</span><span class="p">,</span> <span class="n">tmpdir</span>
<span class="kn">from</span> <span class="nn">aqt</span> <span class="kn">import</span> <span class="n">gui_hooks</span>
<span class="kn">from</span> <span class="nn">aqt.sound</span> <span class="kn">import</span> <span class="n">OnDoneCallback</span><span class="p">,</span> <span class="n">SimpleProcessPlayer</span>


<div class="viewcode-block" id="TTSVoice"><a class="viewcode-back" href="../../aqt.html#aqt.tts.TTSVoice">[docs]</a><span class="nd">@dataclass</span>
<span class="k">class</span> <span class="nc">TTSVoice</span><span class="p">:</span>
    <span class="n">name</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">lang</span><span class="p">:</span> <span class="nb">str</span></div>


<div class="viewcode-block" id="TTSVoiceMatch"><a class="viewcode-back" href="../../aqt.html#aqt.tts.TTSVoiceMatch">[docs]</a><span class="nd">@dataclass</span>
<span class="k">class</span> <span class="nc">TTSVoiceMatch</span><span class="p">:</span>
    <span class="n">voice</span><span class="p">:</span> <span class="n">TTSVoice</span>
    <span class="n">rank</span><span class="p">:</span> <span class="nb">int</span></div>


<div class="viewcode-block" id="TTSPlayer"><a class="viewcode-back" href="../../aqt.html#aqt.tts.TTSPlayer">[docs]</a><span class="k">class</span> <span class="nc">TTSPlayer</span><span class="p">:</span>
    <span class="n">default_rank</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">_available_voices</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">TTSVoice</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span>

<div class="viewcode-block" id="TTSPlayer.get_available_voices"><a class="viewcode-back" href="../../aqt.html#aqt.tts.TTSPlayer.get_available_voices">[docs]</a>    <span class="k">def</span> <span class="nf">get_available_voices</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">TTSVoice</span><span class="p">]:</span>
        <span class="k">return</span> <span class="p">[]</span></div>

<div class="viewcode-block" id="TTSPlayer.voices"><a class="viewcode-back" href="../../aqt.html#aqt.tts.TTSPlayer.voices">[docs]</a>    <span class="k">def</span> <span class="nf">voices</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">TTSVoice</span><span class="p">]:</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_available_voices</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_available_voices</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_available_voices</span><span class="p">()</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_available_voices</span></div>

<div class="viewcode-block" id="TTSPlayer.voice_for_tag"><a class="viewcode-back" href="../../aqt.html#aqt.tts.TTSPlayer.voice_for_tag">[docs]</a>    <span class="k">def</span> <span class="nf">voice_for_tag</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tag</span><span class="p">:</span> <span class="n">TTSTag</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">TTSVoiceMatch</span><span class="p">]:</span>
        <span class="n">avail_voices</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">voices</span><span class="p">()</span>

        <span class="n">rank</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">default_rank</span>

        <span class="c1"># any requested voices match?</span>
        <span class="k">for</span> <span class="n">requested_voice</span> <span class="ow">in</span> <span class="n">tag</span><span class="o">.</span><span class="n">voices</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">avail</span> <span class="ow">in</span> <span class="n">avail_voices</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">avail</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="n">requested_voice</span> <span class="ow">and</span> <span class="n">avail</span><span class="o">.</span><span class="n">lang</span> <span class="o">==</span> <span class="n">tag</span><span class="o">.</span><span class="n">lang</span><span class="p">:</span>
                    <span class="k">return</span> <span class="n">TTSVoiceMatch</span><span class="p">(</span><span class="n">voice</span><span class="o">=</span><span class="n">avail</span><span class="p">,</span> <span class="n">rank</span><span class="o">=</span><span class="n">rank</span><span class="p">)</span>

            <span class="n">rank</span> <span class="o">-=</span> <span class="mi">1</span>

        <span class="c1"># if no preferred voices match, we fall back on language</span>
        <span class="c1"># with a rank of -100</span>
        <span class="k">for</span> <span class="n">avail</span> <span class="ow">in</span> <span class="n">avail_voices</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">avail</span><span class="o">.</span><span class="n">lang</span> <span class="o">==</span> <span class="n">tag</span><span class="o">.</span><span class="n">lang</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">TTSVoiceMatch</span><span class="p">(</span><span class="n">voice</span><span class="o">=</span><span class="n">avail</span><span class="p">,</span> <span class="n">rank</span><span class="o">=-</span><span class="mi">100</span><span class="p">)</span>

        <span class="k">return</span> <span class="kc">None</span></div>

<div class="viewcode-block" id="TTSPlayer.temp_file_for_tag_and_voice"><a class="viewcode-back" href="../../aqt.html#aqt.tts.TTSPlayer.temp_file_for_tag_and_voice">[docs]</a>    <span class="k">def</span> <span class="nf">temp_file_for_tag_and_voice</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tag</span><span class="p">:</span> <span class="n">AVTag</span><span class="p">,</span> <span class="n">voice</span><span class="p">:</span> <span class="n">TTSVoice</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Return a hashed filename, to allow for caching generated files.</span>

<span class="sd">        No file extension is included.&quot;&quot;&quot;</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">tag</span><span class="p">,</span> <span class="n">TTSTag</span><span class="p">)</span>
        <span class="n">buf</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{voice.name}</span><span class="s2">-</span><span class="si">{voice.lang}</span><span class="s2">-</span><span class="si">{tag.field_text}</span><span class="s2">&quot;</span>
        <span class="k">return</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">tmpdir</span><span class="p">(),</span> <span class="sa">f</span><span class="s2">&quot;tts-{checksum(buf)}&quot;</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="TTSProcessPlayer"><a class="viewcode-back" href="../../aqt.html#aqt.tts.TTSProcessPlayer">[docs]</a><span class="k">class</span> <span class="nc">TTSProcessPlayer</span><span class="p">(</span><span class="n">SimpleProcessPlayer</span><span class="p">,</span> <span class="n">TTSPlayer</span><span class="p">):</span>
    <span class="c1"># mypy gets confused if rank_for_tag is defined in TTSPlayer</span>
<div class="viewcode-block" id="TTSProcessPlayer.rank_for_tag"><a class="viewcode-back" href="../../aqt.html#aqt.tts.TTSProcessPlayer.rank_for_tag">[docs]</a>    <span class="k">def</span> <span class="nf">rank_for_tag</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tag</span><span class="p">:</span> <span class="n">AVTag</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">tag</span><span class="p">,</span> <span class="n">TTSTag</span><span class="p">):</span>
            <span class="k">return</span> <span class="kc">None</span>

        <span class="n">match</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">voice_for_tag</span><span class="p">(</span><span class="n">tag</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">match</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">match</span><span class="o">.</span><span class="n">rank</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span></div></div>


<span class="c1"># tts-voices filter</span>
<span class="c1">##########################################################################</span>


<div class="viewcode-block" id="all_tts_voices"><a class="viewcode-back" href="../../aqt.html#aqt.tts.all_tts_voices">[docs]</a><span class="k">def</span> <span class="nf">all_tts_voices</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">TTSVoice</span><span class="p">]:</span>
    <span class="kn">from</span> <span class="nn">aqt.sound</span> <span class="kn">import</span> <span class="n">av_player</span>

    <span class="n">all_voices</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">TTSVoice</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">av_player</span><span class="o">.</span><span class="n">players</span><span class="p">:</span>
        <span class="n">getter</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="s2">&quot;voices&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">getter</span><span class="p">:</span>
            <span class="k">continue</span>
        <span class="n">all_voices</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">getter</span><span class="p">())</span>
    <span class="k">return</span> <span class="n">all_voices</span></div>


<div class="viewcode-block" id="on_tts_voices"><a class="viewcode-back" href="../../aqt.html#aqt.tts.on_tts_voices">[docs]</a><span class="k">def</span> <span class="nf">on_tts_voices</span><span class="p">(</span><span class="n">text</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">field</span><span class="p">,</span> <span class="nb">filter</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">ctx</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
    <span class="k">if</span> <span class="nb">filter</span> <span class="o">!=</span> <span class="s2">&quot;tts-voices&quot;</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">text</span>
    <span class="n">voices</span> <span class="o">=</span> <span class="n">all_tts_voices</span><span class="p">()</span>
    <span class="n">voices</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="n">attrgetter</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">))</span>
    <span class="n">voices</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="n">attrgetter</span><span class="p">(</span><span class="s2">&quot;lang&quot;</span><span class="p">))</span>

    <span class="n">buf</span> <span class="o">=</span> <span class="s2">&quot;&lt;div style=&#39;font-size: 14px; text-align: left;&#39;&gt;TTS voices available:&lt;br&gt;&quot;</span>
    <span class="n">buf</span> <span class="o">+=</span> <span class="s2">&quot;&lt;br&gt;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
        <span class="sa">f</span><span class="s2">&quot;{{{{tts </span><span class="si">{v.lang}</span><span class="s2"> voices=</span><span class="si">{v.name}</span><span class="s2">}}}}&quot;</span>  <span class="c1"># pylint: disable=no-member</span>
        <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">voices</span>
    <span class="p">)</span>
    <span class="k">return</span> <span class="n">buf</span> <span class="o">+</span> <span class="s2">&quot;&lt;/div&gt;&quot;</span></div>


<span class="n">hooks</span><span class="o">.</span><span class="n">field_filter</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">on_tts_voices</span><span class="p">)</span>

<span class="c1"># Mac support</span>
<span class="c1">##########################################################################</span>


<div class="viewcode-block" id="MacVoice"><a class="viewcode-back" href="../../aqt.html#aqt.tts.MacVoice">[docs]</a><span class="nd">@dataclass</span>
<span class="k">class</span> <span class="nc">MacVoice</span><span class="p">(</span><span class="n">TTSVoice</span><span class="p">):</span>
    <span class="n">original_name</span><span class="p">:</span> <span class="nb">str</span></div>


<div class="viewcode-block" id="MacTTSPlayer"><a class="viewcode-back" href="../../aqt.html#aqt.tts.MacTTSPlayer">[docs]</a><span class="k">class</span> <span class="nc">MacTTSPlayer</span><span class="p">(</span><span class="n">TTSProcessPlayer</span><span class="p">):</span>
    <span class="s2">&quot;Invokes a process to play the audio in the background.&quot;</span>

    <span class="n">VOICE_HELP_LINE_RE</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;^(.+)\s+(\S+)\s+#.*$&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_play</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tag</span><span class="p">:</span> <span class="n">AVTag</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">tag</span><span class="p">,</span> <span class="n">TTSTag</span><span class="p">)</span>
        <span class="n">match</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">voice_for_tag</span><span class="p">(</span><span class="n">tag</span><span class="p">)</span>
        <span class="k">assert</span> <span class="n">match</span>
        <span class="n">voice</span> <span class="o">=</span> <span class="n">match</span><span class="o">.</span><span class="n">voice</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">voice</span><span class="p">,</span> <span class="n">MacVoice</span><span class="p">)</span>

        <span class="n">default_wpm</span> <span class="o">=</span> <span class="mi">170</span>
        <span class="n">words_per_min</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">default_wpm</span> <span class="o">*</span> <span class="n">tag</span><span class="o">.</span><span class="n">speed</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_process</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">Popen</span><span class="p">(</span>
            <span class="p">[</span><span class="s2">&quot;say&quot;</span><span class="p">,</span> <span class="s2">&quot;-v&quot;</span><span class="p">,</span> <span class="n">voice</span><span class="o">.</span><span class="n">original_name</span><span class="p">,</span> <span class="s2">&quot;-r&quot;</span><span class="p">,</span> <span class="n">words_per_min</span><span class="p">,</span> <span class="s2">&quot;-f&quot;</span><span class="p">,</span> <span class="s2">&quot;-&quot;</span><span class="p">],</span>
            <span class="n">stdin</span><span class="o">=</span><span class="n">subprocess</span><span class="o">.</span><span class="n">PIPE</span><span class="p">,</span>
            <span class="n">stdout</span><span class="o">=</span><span class="n">subprocess</span><span class="o">.</span><span class="n">DEVNULL</span><span class="p">,</span>
            <span class="n">stderr</span><span class="o">=</span><span class="n">subprocess</span><span class="o">.</span><span class="n">DEVNULL</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="c1"># write the input text to stdin</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_process</span><span class="o">.</span><span class="n">stdin</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">tag</span><span class="o">.</span><span class="n">field_text</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s2">&quot;utf8&quot;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_process</span><span class="o">.</span><span class="n">stdin</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_wait_for_termination</span><span class="p">(</span><span class="n">tag</span><span class="p">)</span>

<div class="viewcode-block" id="MacTTSPlayer.get_available_voices"><a class="viewcode-back" href="../../aqt.html#aqt.tts.MacTTSPlayer.get_available_voices">[docs]</a>    <span class="k">def</span> <span class="nf">get_available_voices</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">TTSVoice</span><span class="p">]:</span>
        <span class="n">cmd</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">run</span><span class="p">(</span>
            <span class="p">[</span><span class="s2">&quot;say&quot;</span><span class="p">,</span> <span class="s2">&quot;-v&quot;</span><span class="p">,</span> <span class="s2">&quot;?&quot;</span><span class="p">],</span> <span class="n">capture_output</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">check</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf8&quot;</span>
        <span class="p">)</span>

        <span class="n">voices</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">cmd</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">splitlines</span><span class="p">():</span>
            <span class="n">voice</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parse_voice_line</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">voice</span><span class="p">:</span>
                <span class="n">voices</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">voice</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">voices</span></div>

    <span class="k">def</span> <span class="nf">_parse_voice_line</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">line</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">TTSVoice</span><span class="p">]:</span>
        <span class="n">m</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">VOICE_HELP_LINE_RE</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">m</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>

        <span class="n">original_name</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
        <span class="n">tidy_name</span> <span class="o">=</span> <span class="s2">&quot;Apple_&quot;</span> <span class="o">+</span> <span class="n">original_name</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">,</span> <span class="s2">&quot;_&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">MacVoice</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">tidy_name</span><span class="p">,</span> <span class="n">original_name</span><span class="o">=</span><span class="n">original_name</span><span class="p">,</span> <span class="n">lang</span><span class="o">=</span><span class="n">m</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span></div>


<div class="viewcode-block" id="MacTTSFilePlayer"><a class="viewcode-back" href="../../aqt.html#aqt.tts.MacTTSFilePlayer">[docs]</a><span class="k">class</span> <span class="nc">MacTTSFilePlayer</span><span class="p">(</span><span class="n">MacTTSPlayer</span><span class="p">):</span>
    <span class="s2">&quot;Generates an .aiff file, which is played using av_player.&quot;</span>

    <span class="n">tmppath</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">tmpdir</span><span class="p">(),</span> <span class="s2">&quot;tts.aiff&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_play</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tag</span><span class="p">:</span> <span class="n">AVTag</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">tag</span><span class="p">,</span> <span class="n">TTSTag</span><span class="p">)</span>
        <span class="n">match</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">voice_for_tag</span><span class="p">(</span><span class="n">tag</span><span class="p">)</span>
        <span class="k">assert</span> <span class="n">match</span>
        <span class="n">voice</span> <span class="o">=</span> <span class="n">match</span><span class="o">.</span><span class="n">voice</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">voice</span><span class="p">,</span> <span class="n">MacVoice</span><span class="p">)</span>

        <span class="n">default_wpm</span> <span class="o">=</span> <span class="mi">170</span>
        <span class="n">words_per_min</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">default_wpm</span> <span class="o">*</span> <span class="n">tag</span><span class="o">.</span><span class="n">speed</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_process</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">Popen</span><span class="p">(</span>
            <span class="p">[</span>
                <span class="s2">&quot;say&quot;</span><span class="p">,</span>
                <span class="s2">&quot;-v&quot;</span><span class="p">,</span>
                <span class="n">voice</span><span class="o">.</span><span class="n">original_name</span><span class="p">,</span>
                <span class="s2">&quot;-r&quot;</span><span class="p">,</span>
                <span class="n">words_per_min</span><span class="p">,</span>
                <span class="s2">&quot;-f&quot;</span><span class="p">,</span>
                <span class="s2">&quot;-&quot;</span><span class="p">,</span>
                <span class="s2">&quot;-o&quot;</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">tmppath</span><span class="p">,</span>
            <span class="p">],</span>
            <span class="n">stdin</span><span class="o">=</span><span class="n">subprocess</span><span class="o">.</span><span class="n">PIPE</span><span class="p">,</span>
            <span class="n">stdout</span><span class="o">=</span><span class="n">subprocess</span><span class="o">.</span><span class="n">DEVNULL</span><span class="p">,</span>
            <span class="n">stderr</span><span class="o">=</span><span class="n">subprocess</span><span class="o">.</span><span class="n">DEVNULL</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="c1"># write the input text to stdin</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_process</span><span class="o">.</span><span class="n">stdin</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">tag</span><span class="o">.</span><span class="n">field_text</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s2">&quot;utf8&quot;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_process</span><span class="o">.</span><span class="n">stdin</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_wait_for_termination</span><span class="p">(</span><span class="n">tag</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_on_done</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ret</span><span class="p">:</span> <span class="n">Future</span><span class="p">,</span> <span class="n">cb</span><span class="p">:</span> <span class="n">OnDoneCallback</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">ret</span><span class="o">.</span><span class="n">result</span><span class="p">()</span>

        <span class="c1"># inject file into the top of the audio queue</span>
        <span class="kn">from</span> <span class="nn">aqt.sound</span> <span class="kn">import</span> <span class="n">av_player</span>

        <span class="n">av_player</span><span class="o">.</span><span class="n">insert_file</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tmppath</span><span class="p">)</span>

        <span class="c1"># then tell player to advance, which will cause the file to be played</span>
        <span class="n">cb</span><span class="p">()</span></div>


<span class="c1"># Windows support</span>
<span class="c1">##########################################################################</span>


<div class="viewcode-block" id="WindowsVoice"><a class="viewcode-back" href="../../aqt.html#aqt.tts.WindowsVoice">[docs]</a><span class="nd">@dataclass</span>
<span class="k">class</span> <span class="nc">WindowsVoice</span><span class="p">(</span><span class="n">TTSVoice</span><span class="p">):</span>
    <span class="n">handle</span><span class="p">:</span> <span class="n">Any</span></div>


<span class="k">if</span> <span class="n">isWin</span><span class="p">:</span>
    <span class="kn">import</span> <span class="nn">win32com.client</span>  <span class="c1"># pylint: disable=import-error</span>

    <span class="c1"># language ID map from https://github.com/sindresorhus/lcid/blob/master/lcid.json</span>
    <span class="n">LCIDS</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;4&quot;</span><span class="p">:</span> <span class="s2">&quot;zh_CHS&quot;</span><span class="p">,</span>
        <span class="s2">&quot;1025&quot;</span><span class="p">:</span> <span class="s2">&quot;ar_SA&quot;</span><span class="p">,</span>
        <span class="s2">&quot;1026&quot;</span><span class="p">:</span> <span class="s2">&quot;bg_BG&quot;</span><span class="p">,</span>
        <span class="s2">&quot;1027&quot;</span><span class="p">:</span> <span class="s2">&quot;ca_ES&quot;</span><span class="p">,</span>
        <span class="s2">&quot;1028&quot;</span><span class="p">:</span> <span class="s2">&quot;zh_TW&quot;</span><span class="p">,</span>
        <span class="s2">&quot;1029&quot;</span><span class="p">:</span> <span class="s2">&quot;cs_CZ&quot;</span><span class="p">,</span>
        <span class="s2">&quot;1030&quot;</span><span class="p">:</span> <span class="s2">&quot;da_DK&quot;</span><span class="p">,</span>
        <span class="s2">&quot;1031&quot;</span><span class="p">:</span> <span class="s2">&quot;de_DE&quot;</span><span class="p">,</span>
        <span class="s2">&quot;1032&quot;</span><span class="p">:</span> <span class="s2">&quot;el_GR&quot;</span><span class="p">,</span>
        <span class="s2">&quot;1033&quot;</span><span class="p">:</span> <span class="s2">&quot;en_US&quot;</span><span class="p">,</span>
        <span class="s2">&quot;1034&quot;</span><span class="p">:</span> <span class="s2">&quot;es_ES&quot;</span><span class="p">,</span>
        <span class="s2">&quot;1035&quot;</span><span class="p">:</span> <span class="s2">&quot;fi_FI&quot;</span><span class="p">,</span>
        <span class="s2">&quot;1036&quot;</span><span class="p">:</span> <span class="s2">&quot;fr_FR&quot;</span><span class="p">,</span>
        <span class="s2">&quot;1037&quot;</span><span class="p">:</span> <span class="s2">&quot;he_IL&quot;</span><span class="p">,</span>
        <span class="s2">&quot;1038&quot;</span><span class="p">:</span> <span class="s2">&quot;hu_HU&quot;</span><span class="p">,</span>
        <span class="s2">&quot;1039&quot;</span><span class="p">:</span> <span class="s2">&quot;is_IS&quot;</span><span class="p">,</span>
        <span class="s2">&quot;1040&quot;</span><span class="p">:</span> <span class="s2">&quot;it_IT&quot;</span><span class="p">,</span>
        <span class="s2">&quot;1041&quot;</span><span class="p">:</span> <span class="s2">&quot;ja_JP&quot;</span><span class="p">,</span>
        <span class="s2">&quot;1042&quot;</span><span class="p">:</span> <span class="s2">&quot;ko_KR&quot;</span><span class="p">,</span>
        <span class="s2">&quot;1043&quot;</span><span class="p">:</span> <span class="s2">&quot;nl_NL&quot;</span><span class="p">,</span>
        <span class="s2">&quot;1044&quot;</span><span class="p">:</span> <span class="s2">&quot;nb_NO&quot;</span><span class="p">,</span>
        <span class="s2">&quot;1045&quot;</span><span class="p">:</span> <span class="s2">&quot;pl_PL&quot;</span><span class="p">,</span>
        <span class="s2">&quot;1046&quot;</span><span class="p">:</span> <span class="s2">&quot;pt_BR&quot;</span><span class="p">,</span>
        <span class="s2">&quot;1047&quot;</span><span class="p">:</span> <span class="s2">&quot;rm_CH&quot;</span><span class="p">,</span>
        <span class="s2">&quot;1048&quot;</span><span class="p">:</span> <span class="s2">&quot;ro_RO&quot;</span><span class="p">,</span>
        <span class="s2">&quot;1049&quot;</span><span class="p">:</span> <span class="s2">&quot;ru_RU&quot;</span><span class="p">,</span>
        <span class="s2">&quot;1050&quot;</span><span class="p">:</span> <span class="s2">&quot;hr_HR&quot;</span><span class="p">,</span>
        <span class="s2">&quot;1051&quot;</span><span class="p">:</span> <span class="s2">&quot;sk_SK&quot;</span><span class="p">,</span>
        <span class="s2">&quot;1052&quot;</span><span class="p">:</span> <span class="s2">&quot;sq_AL&quot;</span><span class="p">,</span>
        <span class="s2">&quot;1053&quot;</span><span class="p">:</span> <span class="s2">&quot;sv_SE&quot;</span><span class="p">,</span>
        <span class="s2">&quot;1054&quot;</span><span class="p">:</span> <span class="s2">&quot;th_TH&quot;</span><span class="p">,</span>
        <span class="s2">&quot;1055&quot;</span><span class="p">:</span> <span class="s2">&quot;tr_TR&quot;</span><span class="p">,</span>
        <span class="s2">&quot;1056&quot;</span><span class="p">:</span> <span class="s2">&quot;ur_PK&quot;</span><span class="p">,</span>
        <span class="s2">&quot;1057&quot;</span><span class="p">:</span> <span class="s2">&quot;id_ID&quot;</span><span class="p">,</span>
        <span class="s2">&quot;1058&quot;</span><span class="p">:</span> <span class="s2">&quot;uk_UA&quot;</span><span class="p">,</span>
        <span class="s2">&quot;1059&quot;</span><span class="p">:</span> <span class="s2">&quot;be_BY&quot;</span><span class="p">,</span>
        <span class="s2">&quot;1060&quot;</span><span class="p">:</span> <span class="s2">&quot;sl_SI&quot;</span><span class="p">,</span>
        <span class="s2">&quot;1061&quot;</span><span class="p">:</span> <span class="s2">&quot;et_EE&quot;</span><span class="p">,</span>
        <span class="s2">&quot;1062&quot;</span><span class="p">:</span> <span class="s2">&quot;lv_LV&quot;</span><span class="p">,</span>
        <span class="s2">&quot;1063&quot;</span><span class="p">:</span> <span class="s2">&quot;lt_LT&quot;</span><span class="p">,</span>
        <span class="s2">&quot;1064&quot;</span><span class="p">:</span> <span class="s2">&quot;tg_TJ&quot;</span><span class="p">,</span>
        <span class="s2">&quot;1065&quot;</span><span class="p">:</span> <span class="s2">&quot;fa_IR&quot;</span><span class="p">,</span>
        <span class="s2">&quot;1066&quot;</span><span class="p">:</span> <span class="s2">&quot;vi_VN&quot;</span><span class="p">,</span>
        <span class="s2">&quot;1067&quot;</span><span class="p">:</span> <span class="s2">&quot;hy_AM&quot;</span><span class="p">,</span>
        <span class="s2">&quot;1069&quot;</span><span class="p">:</span> <span class="s2">&quot;eu_ES&quot;</span><span class="p">,</span>
        <span class="s2">&quot;1070&quot;</span><span class="p">:</span> <span class="s2">&quot;wen_DE&quot;</span><span class="p">,</span>
        <span class="s2">&quot;1071&quot;</span><span class="p">:</span> <span class="s2">&quot;mk_MK&quot;</span><span class="p">,</span>
        <span class="s2">&quot;1074&quot;</span><span class="p">:</span> <span class="s2">&quot;tn_ZA&quot;</span><span class="p">,</span>
        <span class="s2">&quot;1076&quot;</span><span class="p">:</span> <span class="s2">&quot;xh_ZA&quot;</span><span class="p">,</span>
        <span class="s2">&quot;1077&quot;</span><span class="p">:</span> <span class="s2">&quot;zu_ZA&quot;</span><span class="p">,</span>
        <span class="s2">&quot;1078&quot;</span><span class="p">:</span> <span class="s2">&quot;af_ZA&quot;</span><span class="p">,</span>
        <span class="s2">&quot;1079&quot;</span><span class="p">:</span> <span class="s2">&quot;ka_GE&quot;</span><span class="p">,</span>
        <span class="s2">&quot;1080&quot;</span><span class="p">:</span> <span class="s2">&quot;fo_FO&quot;</span><span class="p">,</span>
        <span class="s2">&quot;1081&quot;</span><span class="p">:</span> <span class="s2">&quot;hi_IN&quot;</span><span class="p">,</span>
        <span class="s2">&quot;1082&quot;</span><span class="p">:</span> <span class="s2">&quot;mt_MT&quot;</span><span class="p">,</span>
        <span class="s2">&quot;1083&quot;</span><span class="p">:</span> <span class="s2">&quot;se_NO&quot;</span><span class="p">,</span>
        <span class="s2">&quot;1086&quot;</span><span class="p">:</span> <span class="s2">&quot;ms_MY&quot;</span><span class="p">,</span>
        <span class="s2">&quot;1087&quot;</span><span class="p">:</span> <span class="s2">&quot;kk_KZ&quot;</span><span class="p">,</span>
        <span class="s2">&quot;1088&quot;</span><span class="p">:</span> <span class="s2">&quot;ky_KG&quot;</span><span class="p">,</span>
        <span class="s2">&quot;1089&quot;</span><span class="p">:</span> <span class="s2">&quot;sw_KE&quot;</span><span class="p">,</span>
        <span class="s2">&quot;1090&quot;</span><span class="p">:</span> <span class="s2">&quot;tk_TM&quot;</span><span class="p">,</span>
        <span class="s2">&quot;1092&quot;</span><span class="p">:</span> <span class="s2">&quot;tt_RU&quot;</span><span class="p">,</span>
        <span class="s2">&quot;1093&quot;</span><span class="p">:</span> <span class="s2">&quot;bn_IN&quot;</span><span class="p">,</span>
        <span class="s2">&quot;1094&quot;</span><span class="p">:</span> <span class="s2">&quot;pa_IN&quot;</span><span class="p">,</span>
        <span class="s2">&quot;1095&quot;</span><span class="p">:</span> <span class="s2">&quot;gu_IN&quot;</span><span class="p">,</span>
        <span class="s2">&quot;1096&quot;</span><span class="p">:</span> <span class="s2">&quot;or_IN&quot;</span><span class="p">,</span>
        <span class="s2">&quot;1097&quot;</span><span class="p">:</span> <span class="s2">&quot;ta_IN&quot;</span><span class="p">,</span>
        <span class="s2">&quot;1098&quot;</span><span class="p">:</span> <span class="s2">&quot;te_IN&quot;</span><span class="p">,</span>
        <span class="s2">&quot;1099&quot;</span><span class="p">:</span> <span class="s2">&quot;kn_IN&quot;</span><span class="p">,</span>
        <span class="s2">&quot;1100&quot;</span><span class="p">:</span> <span class="s2">&quot;ml_IN&quot;</span><span class="p">,</span>
        <span class="s2">&quot;1101&quot;</span><span class="p">:</span> <span class="s2">&quot;as_IN&quot;</span><span class="p">,</span>
        <span class="s2">&quot;1102&quot;</span><span class="p">:</span> <span class="s2">&quot;mr_IN&quot;</span><span class="p">,</span>
        <span class="s2">&quot;1103&quot;</span><span class="p">:</span> <span class="s2">&quot;sa_IN&quot;</span><span class="p">,</span>
        <span class="s2">&quot;1104&quot;</span><span class="p">:</span> <span class="s2">&quot;mn_MN&quot;</span><span class="p">,</span>
        <span class="s2">&quot;1105&quot;</span><span class="p">:</span> <span class="s2">&quot;bo_CN&quot;</span><span class="p">,</span>
        <span class="s2">&quot;1106&quot;</span><span class="p">:</span> <span class="s2">&quot;cy_GB&quot;</span><span class="p">,</span>
        <span class="s2">&quot;1107&quot;</span><span class="p">:</span> <span class="s2">&quot;kh_KH&quot;</span><span class="p">,</span>
        <span class="s2">&quot;1108&quot;</span><span class="p">:</span> <span class="s2">&quot;lo_LA&quot;</span><span class="p">,</span>
        <span class="s2">&quot;1109&quot;</span><span class="p">:</span> <span class="s2">&quot;my_MM&quot;</span><span class="p">,</span>
        <span class="s2">&quot;1110&quot;</span><span class="p">:</span> <span class="s2">&quot;gl_ES&quot;</span><span class="p">,</span>
        <span class="s2">&quot;1111&quot;</span><span class="p">:</span> <span class="s2">&quot;kok_IN&quot;</span><span class="p">,</span>
        <span class="s2">&quot;1114&quot;</span><span class="p">:</span> <span class="s2">&quot;syr_SY&quot;</span><span class="p">,</span>
        <span class="s2">&quot;1115&quot;</span><span class="p">:</span> <span class="s2">&quot;si_LK&quot;</span><span class="p">,</span>
        <span class="s2">&quot;1118&quot;</span><span class="p">:</span> <span class="s2">&quot;am_ET&quot;</span><span class="p">,</span>
        <span class="s2">&quot;1121&quot;</span><span class="p">:</span> <span class="s2">&quot;ne_NP&quot;</span><span class="p">,</span>
        <span class="s2">&quot;1122&quot;</span><span class="p">:</span> <span class="s2">&quot;fy_NL&quot;</span><span class="p">,</span>
        <span class="s2">&quot;1123&quot;</span><span class="p">:</span> <span class="s2">&quot;ps_AF&quot;</span><span class="p">,</span>
        <span class="s2">&quot;1124&quot;</span><span class="p">:</span> <span class="s2">&quot;fil_PH&quot;</span><span class="p">,</span>
        <span class="s2">&quot;1125&quot;</span><span class="p">:</span> <span class="s2">&quot;div_MV&quot;</span><span class="p">,</span>
        <span class="s2">&quot;1128&quot;</span><span class="p">:</span> <span class="s2">&quot;ha_NG&quot;</span><span class="p">,</span>
        <span class="s2">&quot;1130&quot;</span><span class="p">:</span> <span class="s2">&quot;yo_NG&quot;</span><span class="p">,</span>
        <span class="s2">&quot;1131&quot;</span><span class="p">:</span> <span class="s2">&quot;quz_BO&quot;</span><span class="p">,</span>
        <span class="s2">&quot;1132&quot;</span><span class="p">:</span> <span class="s2">&quot;ns_ZA&quot;</span><span class="p">,</span>
        <span class="s2">&quot;1133&quot;</span><span class="p">:</span> <span class="s2">&quot;ba_RU&quot;</span><span class="p">,</span>
        <span class="s2">&quot;1134&quot;</span><span class="p">:</span> <span class="s2">&quot;lb_LU&quot;</span><span class="p">,</span>
        <span class="s2">&quot;1135&quot;</span><span class="p">:</span> <span class="s2">&quot;kl_GL&quot;</span><span class="p">,</span>
        <span class="s2">&quot;1144&quot;</span><span class="p">:</span> <span class="s2">&quot;ii_CN&quot;</span><span class="p">,</span>
        <span class="s2">&quot;1146&quot;</span><span class="p">:</span> <span class="s2">&quot;arn_CL&quot;</span><span class="p">,</span>
        <span class="s2">&quot;1148&quot;</span><span class="p">:</span> <span class="s2">&quot;moh_CA&quot;</span><span class="p">,</span>
        <span class="s2">&quot;1150&quot;</span><span class="p">:</span> <span class="s2">&quot;br_FR&quot;</span><span class="p">,</span>
        <span class="s2">&quot;1152&quot;</span><span class="p">:</span> <span class="s2">&quot;ug_CN&quot;</span><span class="p">,</span>
        <span class="s2">&quot;1153&quot;</span><span class="p">:</span> <span class="s2">&quot;mi_NZ&quot;</span><span class="p">,</span>
        <span class="s2">&quot;1154&quot;</span><span class="p">:</span> <span class="s2">&quot;oc_FR&quot;</span><span class="p">,</span>
        <span class="s2">&quot;1155&quot;</span><span class="p">:</span> <span class="s2">&quot;co_FR&quot;</span><span class="p">,</span>
        <span class="s2">&quot;1156&quot;</span><span class="p">:</span> <span class="s2">&quot;gsw_FR&quot;</span><span class="p">,</span>
        <span class="s2">&quot;1157&quot;</span><span class="p">:</span> <span class="s2">&quot;sah_RU&quot;</span><span class="p">,</span>
        <span class="s2">&quot;1158&quot;</span><span class="p">:</span> <span class="s2">&quot;qut_GT&quot;</span><span class="p">,</span>
        <span class="s2">&quot;1159&quot;</span><span class="p">:</span> <span class="s2">&quot;rw_RW&quot;</span><span class="p">,</span>
        <span class="s2">&quot;1160&quot;</span><span class="p">:</span> <span class="s2">&quot;wo_SN&quot;</span><span class="p">,</span>
        <span class="s2">&quot;1164&quot;</span><span class="p">:</span> <span class="s2">&quot;gbz_AF&quot;</span><span class="p">,</span>
        <span class="s2">&quot;2049&quot;</span><span class="p">:</span> <span class="s2">&quot;ar_IQ&quot;</span><span class="p">,</span>
        <span class="s2">&quot;2052&quot;</span><span class="p">:</span> <span class="s2">&quot;zh_CN&quot;</span><span class="p">,</span>
        <span class="s2">&quot;2055&quot;</span><span class="p">:</span> <span class="s2">&quot;de_CH&quot;</span><span class="p">,</span>
        <span class="s2">&quot;2057&quot;</span><span class="p">:</span> <span class="s2">&quot;en_GB&quot;</span><span class="p">,</span>
        <span class="s2">&quot;2058&quot;</span><span class="p">:</span> <span class="s2">&quot;es_MX&quot;</span><span class="p">,</span>
        <span class="s2">&quot;2060&quot;</span><span class="p">:</span> <span class="s2">&quot;fr_BE&quot;</span><span class="p">,</span>
        <span class="s2">&quot;2064&quot;</span><span class="p">:</span> <span class="s2">&quot;it_CH&quot;</span><span class="p">,</span>
        <span class="s2">&quot;2067&quot;</span><span class="p">:</span> <span class="s2">&quot;nl_BE&quot;</span><span class="p">,</span>
        <span class="s2">&quot;2068&quot;</span><span class="p">:</span> <span class="s2">&quot;nn_NO&quot;</span><span class="p">,</span>
        <span class="s2">&quot;2070&quot;</span><span class="p">:</span> <span class="s2">&quot;pt_PT&quot;</span><span class="p">,</span>
        <span class="s2">&quot;2077&quot;</span><span class="p">:</span> <span class="s2">&quot;sv_FI&quot;</span><span class="p">,</span>
        <span class="s2">&quot;2080&quot;</span><span class="p">:</span> <span class="s2">&quot;ur_IN&quot;</span><span class="p">,</span>
        <span class="s2">&quot;2092&quot;</span><span class="p">:</span> <span class="s2">&quot;az_AZ&quot;</span><span class="p">,</span>
        <span class="s2">&quot;2094&quot;</span><span class="p">:</span> <span class="s2">&quot;dsb_DE&quot;</span><span class="p">,</span>
        <span class="s2">&quot;2107&quot;</span><span class="p">:</span> <span class="s2">&quot;se_SE&quot;</span><span class="p">,</span>
        <span class="s2">&quot;2108&quot;</span><span class="p">:</span> <span class="s2">&quot;ga_IE&quot;</span><span class="p">,</span>
        <span class="s2">&quot;2110&quot;</span><span class="p">:</span> <span class="s2">&quot;ms_BN&quot;</span><span class="p">,</span>
        <span class="s2">&quot;2115&quot;</span><span class="p">:</span> <span class="s2">&quot;uz_UZ&quot;</span><span class="p">,</span>
        <span class="s2">&quot;2128&quot;</span><span class="p">:</span> <span class="s2">&quot;mn_CN&quot;</span><span class="p">,</span>
        <span class="s2">&quot;2129&quot;</span><span class="p">:</span> <span class="s2">&quot;bo_BT&quot;</span><span class="p">,</span>
        <span class="s2">&quot;2141&quot;</span><span class="p">:</span> <span class="s2">&quot;iu_CA&quot;</span><span class="p">,</span>
        <span class="s2">&quot;2143&quot;</span><span class="p">:</span> <span class="s2">&quot;tmz_DZ&quot;</span><span class="p">,</span>
        <span class="s2">&quot;2155&quot;</span><span class="p">:</span> <span class="s2">&quot;quz_EC&quot;</span><span class="p">,</span>
        <span class="s2">&quot;3073&quot;</span><span class="p">:</span> <span class="s2">&quot;ar_EG&quot;</span><span class="p">,</span>
        <span class="s2">&quot;3076&quot;</span><span class="p">:</span> <span class="s2">&quot;zh_HK&quot;</span><span class="p">,</span>
        <span class="s2">&quot;3079&quot;</span><span class="p">:</span> <span class="s2">&quot;de_AT&quot;</span><span class="p">,</span>
        <span class="s2">&quot;3081&quot;</span><span class="p">:</span> <span class="s2">&quot;en_AU&quot;</span><span class="p">,</span>
        <span class="s2">&quot;3082&quot;</span><span class="p">:</span> <span class="s2">&quot;es_ES&quot;</span><span class="p">,</span>
        <span class="s2">&quot;3084&quot;</span><span class="p">:</span> <span class="s2">&quot;fr_CA&quot;</span><span class="p">,</span>
        <span class="s2">&quot;3098&quot;</span><span class="p">:</span> <span class="s2">&quot;sr_SP&quot;</span><span class="p">,</span>
        <span class="s2">&quot;3131&quot;</span><span class="p">:</span> <span class="s2">&quot;se_FI&quot;</span><span class="p">,</span>
        <span class="s2">&quot;3179&quot;</span><span class="p">:</span> <span class="s2">&quot;quz_PE&quot;</span><span class="p">,</span>
        <span class="s2">&quot;4097&quot;</span><span class="p">:</span> <span class="s2">&quot;ar_LY&quot;</span><span class="p">,</span>
        <span class="s2">&quot;4100&quot;</span><span class="p">:</span> <span class="s2">&quot;zh_SG&quot;</span><span class="p">,</span>
        <span class="s2">&quot;4103&quot;</span><span class="p">:</span> <span class="s2">&quot;de_LU&quot;</span><span class="p">,</span>
        <span class="s2">&quot;4105&quot;</span><span class="p">:</span> <span class="s2">&quot;en_CA&quot;</span><span class="p">,</span>
        <span class="s2">&quot;4106&quot;</span><span class="p">:</span> <span class="s2">&quot;es_GT&quot;</span><span class="p">,</span>
        <span class="s2">&quot;4108&quot;</span><span class="p">:</span> <span class="s2">&quot;fr_CH&quot;</span><span class="p">,</span>
        <span class="s2">&quot;4122&quot;</span><span class="p">:</span> <span class="s2">&quot;hr_BA&quot;</span><span class="p">,</span>
        <span class="s2">&quot;4155&quot;</span><span class="p">:</span> <span class="s2">&quot;smj_NO&quot;</span><span class="p">,</span>
        <span class="s2">&quot;5121&quot;</span><span class="p">:</span> <span class="s2">&quot;ar_DZ&quot;</span><span class="p">,</span>
        <span class="s2">&quot;5124&quot;</span><span class="p">:</span> <span class="s2">&quot;zh_MO&quot;</span><span class="p">,</span>
        <span class="s2">&quot;5127&quot;</span><span class="p">:</span> <span class="s2">&quot;de_LI&quot;</span><span class="p">,</span>
        <span class="s2">&quot;5129&quot;</span><span class="p">:</span> <span class="s2">&quot;en_NZ&quot;</span><span class="p">,</span>
        <span class="s2">&quot;5130&quot;</span><span class="p">:</span> <span class="s2">&quot;es_CR&quot;</span><span class="p">,</span>
        <span class="s2">&quot;5132&quot;</span><span class="p">:</span> <span class="s2">&quot;fr_LU&quot;</span><span class="p">,</span>
        <span class="s2">&quot;5179&quot;</span><span class="p">:</span> <span class="s2">&quot;smj_SE&quot;</span><span class="p">,</span>
        <span class="s2">&quot;6145&quot;</span><span class="p">:</span> <span class="s2">&quot;ar_MA&quot;</span><span class="p">,</span>
        <span class="s2">&quot;6153&quot;</span><span class="p">:</span> <span class="s2">&quot;en_IE&quot;</span><span class="p">,</span>
        <span class="s2">&quot;6154&quot;</span><span class="p">:</span> <span class="s2">&quot;es_PA&quot;</span><span class="p">,</span>
        <span class="s2">&quot;6156&quot;</span><span class="p">:</span> <span class="s2">&quot;fr_MC&quot;</span><span class="p">,</span>
        <span class="s2">&quot;6203&quot;</span><span class="p">:</span> <span class="s2">&quot;sma_NO&quot;</span><span class="p">,</span>
        <span class="s2">&quot;7169&quot;</span><span class="p">:</span> <span class="s2">&quot;ar_TN&quot;</span><span class="p">,</span>
        <span class="s2">&quot;7177&quot;</span><span class="p">:</span> <span class="s2">&quot;en_ZA&quot;</span><span class="p">,</span>
        <span class="s2">&quot;7178&quot;</span><span class="p">:</span> <span class="s2">&quot;es_DO&quot;</span><span class="p">,</span>
        <span class="s2">&quot;7194&quot;</span><span class="p">:</span> <span class="s2">&quot;sr_BA&quot;</span><span class="p">,</span>
        <span class="s2">&quot;7227&quot;</span><span class="p">:</span> <span class="s2">&quot;sma_SE&quot;</span><span class="p">,</span>
        <span class="s2">&quot;8193&quot;</span><span class="p">:</span> <span class="s2">&quot;ar_OM&quot;</span><span class="p">,</span>
        <span class="s2">&quot;8201&quot;</span><span class="p">:</span> <span class="s2">&quot;en_JA&quot;</span><span class="p">,</span>
        <span class="s2">&quot;8202&quot;</span><span class="p">:</span> <span class="s2">&quot;es_VE&quot;</span><span class="p">,</span>
        <span class="s2">&quot;8218&quot;</span><span class="p">:</span> <span class="s2">&quot;bs_BA&quot;</span><span class="p">,</span>
        <span class="s2">&quot;8251&quot;</span><span class="p">:</span> <span class="s2">&quot;sms_FI&quot;</span><span class="p">,</span>
        <span class="s2">&quot;9217&quot;</span><span class="p">:</span> <span class="s2">&quot;ar_YE&quot;</span><span class="p">,</span>
        <span class="s2">&quot;9225&quot;</span><span class="p">:</span> <span class="s2">&quot;en_CB&quot;</span><span class="p">,</span>
        <span class="s2">&quot;9226&quot;</span><span class="p">:</span> <span class="s2">&quot;es_CO&quot;</span><span class="p">,</span>
        <span class="s2">&quot;9275&quot;</span><span class="p">:</span> <span class="s2">&quot;smn_FI&quot;</span><span class="p">,</span>
        <span class="s2">&quot;10241&quot;</span><span class="p">:</span> <span class="s2">&quot;ar_SY&quot;</span><span class="p">,</span>
        <span class="s2">&quot;10249&quot;</span><span class="p">:</span> <span class="s2">&quot;en_BZ&quot;</span><span class="p">,</span>
        <span class="s2">&quot;10250&quot;</span><span class="p">:</span> <span class="s2">&quot;es_PE&quot;</span><span class="p">,</span>
        <span class="s2">&quot;11265&quot;</span><span class="p">:</span> <span class="s2">&quot;ar_JO&quot;</span><span class="p">,</span>
        <span class="s2">&quot;11273&quot;</span><span class="p">:</span> <span class="s2">&quot;en_TT&quot;</span><span class="p">,</span>
        <span class="s2">&quot;11274&quot;</span><span class="p">:</span> <span class="s2">&quot;es_AR&quot;</span><span class="p">,</span>
        <span class="s2">&quot;12289&quot;</span><span class="p">:</span> <span class="s2">&quot;ar_LB&quot;</span><span class="p">,</span>
        <span class="s2">&quot;12297&quot;</span><span class="p">:</span> <span class="s2">&quot;en_ZW&quot;</span><span class="p">,</span>
        <span class="s2">&quot;12298&quot;</span><span class="p">:</span> <span class="s2">&quot;es_EC&quot;</span><span class="p">,</span>
        <span class="s2">&quot;13313&quot;</span><span class="p">:</span> <span class="s2">&quot;ar_KW&quot;</span><span class="p">,</span>
        <span class="s2">&quot;13321&quot;</span><span class="p">:</span> <span class="s2">&quot;en_PH&quot;</span><span class="p">,</span>
        <span class="s2">&quot;13322&quot;</span><span class="p">:</span> <span class="s2">&quot;es_CL&quot;</span><span class="p">,</span>
        <span class="s2">&quot;14337&quot;</span><span class="p">:</span> <span class="s2">&quot;ar_AE&quot;</span><span class="p">,</span>
        <span class="s2">&quot;14346&quot;</span><span class="p">:</span> <span class="s2">&quot;es_UR&quot;</span><span class="p">,</span>
        <span class="s2">&quot;15361&quot;</span><span class="p">:</span> <span class="s2">&quot;ar_BH&quot;</span><span class="p">,</span>
        <span class="s2">&quot;15370&quot;</span><span class="p">:</span> <span class="s2">&quot;es_PY&quot;</span><span class="p">,</span>
        <span class="s2">&quot;16385&quot;</span><span class="p">:</span> <span class="s2">&quot;ar_QA&quot;</span><span class="p">,</span>
        <span class="s2">&quot;16394&quot;</span><span class="p">:</span> <span class="s2">&quot;es_BO&quot;</span><span class="p">,</span>
        <span class="s2">&quot;17417&quot;</span><span class="p">:</span> <span class="s2">&quot;en_MY&quot;</span><span class="p">,</span>
        <span class="s2">&quot;17418&quot;</span><span class="p">:</span> <span class="s2">&quot;es_SV&quot;</span><span class="p">,</span>
        <span class="s2">&quot;18441&quot;</span><span class="p">:</span> <span class="s2">&quot;en_IN&quot;</span><span class="p">,</span>
        <span class="s2">&quot;18442&quot;</span><span class="p">:</span> <span class="s2">&quot;es_HN&quot;</span><span class="p">,</span>
        <span class="s2">&quot;19466&quot;</span><span class="p">:</span> <span class="s2">&quot;es_NI&quot;</span><span class="p">,</span>
        <span class="s2">&quot;20490&quot;</span><span class="p">:</span> <span class="s2">&quot;es_PR&quot;</span><span class="p">,</span>
        <span class="s2">&quot;21514&quot;</span><span class="p">:</span> <span class="s2">&quot;es_US&quot;</span><span class="p">,</span>
        <span class="s2">&quot;31748&quot;</span><span class="p">:</span> <span class="s2">&quot;zh_CHT&quot;</span><span class="p">,</span>
    <span class="p">}</span>

    <span class="k">def</span> <span class="nf">lcid_hex_str_to_lang_code</span><span class="p">(</span><span class="nb">hex</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="n">dec_str</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="nb">hex</span><span class="p">,</span> <span class="mi">16</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">LCIDS</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">dec_str</span><span class="p">,</span> <span class="s2">&quot;unknown&quot;</span><span class="p">)</span>

    <span class="k">class</span> <span class="nc">WindowsTTSPlayer</span><span class="p">(</span><span class="n">TTSProcessPlayer</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">speaker</span> <span class="o">=</span> <span class="n">win32com</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">Dispatch</span><span class="p">(</span><span class="s2">&quot;SAPI.SpVoice&quot;</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="n">speaker</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="k">def</span> <span class="nf">get_available_voices</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">TTSVoice</span><span class="p">]:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">speaker</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">return</span> <span class="p">[]</span>
            <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_voice_to_object</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">speaker</span><span class="o">.</span><span class="n">GetVoices</span><span class="p">()))</span>

        <span class="k">def</span> <span class="nf">_voice_to_object</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">voice</span><span class="p">:</span> <span class="n">Any</span><span class="p">):</span>
            <span class="n">lang</span> <span class="o">=</span> <span class="n">voice</span><span class="o">.</span><span class="n">GetAttribute</span><span class="p">(</span><span class="s2">&quot;language&quot;</span><span class="p">)</span>
            <span class="n">lang</span> <span class="o">=</span> <span class="n">lcid_hex_str_to_lang_code</span><span class="p">(</span><span class="n">lang</span><span class="p">)</span>
            <span class="n">name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tidy_name</span><span class="p">(</span><span class="n">voice</span><span class="o">.</span><span class="n">GetAttribute</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">))</span>
            <span class="k">return</span> <span class="n">WindowsVoice</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span> <span class="n">lang</span><span class="o">=</span><span class="n">lang</span><span class="p">,</span> <span class="n">handle</span><span class="o">=</span><span class="n">voice</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">_play</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tag</span><span class="p">:</span> <span class="n">AVTag</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">tag</span><span class="p">,</span> <span class="n">TTSTag</span><span class="p">)</span>
            <span class="n">match</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">voice_for_tag</span><span class="p">(</span><span class="n">tag</span><span class="p">)</span>
            <span class="k">assert</span> <span class="n">match</span>
            <span class="n">voice</span> <span class="o">=</span> <span class="n">cast</span><span class="p">(</span><span class="n">WindowsVoice</span><span class="p">,</span> <span class="n">match</span><span class="o">.</span><span class="n">voice</span><span class="p">)</span>

            <span class="k">try</span><span class="p">:</span>
                <span class="n">native_voice</span> <span class="o">=</span> <span class="n">voice</span><span class="o">.</span><span class="n">handle</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">speaker</span><span class="o">.</span><span class="n">Voice</span> <span class="o">=</span> <span class="n">native_voice</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">speaker</span><span class="o">.</span><span class="n">Rate</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_rate_for_speed</span><span class="p">(</span><span class="n">tag</span><span class="o">.</span><span class="n">speed</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">speaker</span><span class="o">.</span><span class="n">Speak</span><span class="p">(</span><span class="n">tag</span><span class="o">.</span><span class="n">field_text</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
                <span class="n">gui_hooks</span><span class="o">.</span><span class="n">av_player_did_begin_playing</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tag</span><span class="p">)</span>

                <span class="c1"># wait 100ms</span>
                <span class="k">while</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">speaker</span><span class="o">.</span><span class="n">WaitUntilDone</span><span class="p">(</span><span class="mi">100</span><span class="p">):</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_terminate_flag</span><span class="p">:</span>
                        <span class="c1"># stop playing</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">speaker</span><span class="o">.</span><span class="n">Skip</span><span class="p">(</span><span class="s2">&quot;Sentence&quot;</span><span class="p">,</span> <span class="mi">2</span> <span class="o">**</span> <span class="mi">15</span><span class="p">)</span>
                        <span class="k">return</span>
            <span class="k">finally</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_terminate_flag</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="k">def</span> <span class="nf">_tidy_name</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
            <span class="s2">&quot;eg. Microsoft Haruka Desktop -&gt; Microsoft_Haruka.&quot;</span>
            <span class="k">return</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;^Microsoft (.+) Desktop$&quot;</span><span class="p">,</span> <span class="s2">&quot;Microsoft_</span><span class="se">\\</span><span class="s2">1&quot;</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span>
                <span class="s2">&quot; &quot;</span><span class="p">,</span> <span class="s2">&quot;_&quot;</span>
            <span class="p">)</span>

        <span class="k">def</span> <span class="nf">_rate_for_speed</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">speed</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
            <span class="s2">&quot;eg. 1.5 -&gt; 15, 0.5 -&gt; -5&quot;</span>
            <span class="n">speed</span> <span class="o">=</span> <span class="p">(</span><span class="n">speed</span> <span class="o">*</span> <span class="mi">10</span><span class="p">)</span> <span class="o">-</span> <span class="mi">10</span>
            <span class="k">return</span> <span class="nb">int</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="o">-</span><span class="mi">10</span><span class="p">,</span> <span class="nb">min</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="n">speed</span><span class="p">)))</span>
</pre></div>

           </div>
           
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        
        &copy; Copyright 2020, Abdelrahman Hamdy

    </p>
  </div>
    
    
    
    Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>